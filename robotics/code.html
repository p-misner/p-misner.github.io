<!DOCTYPE html>
<html>
	<head>
		<title> Visualization Code </title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="stylesheet" type="text/css" href="./prism.css">
	</head>

	<body>
		<pre class="language-python"><code>
var margin = {top: 30, right: 20, bottom: 30, left: 50},
	width = 900 - margin.left - margin.right,
	height = 400 - margin.top - margin.bottom;

var svg = d3.select("#proj")
			.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
					.style("stroke","orange")
					.style("background-color","smokewhite");

/*GETTING PROJECTILE DATA */
function dcos(angle){
	return Math.cos(30 *Math.PI/180)
}
function dsin(angle){
	return Math.sin(30 *Math.PI/180)
}
function dcconvert(x){
		return 77.9 - 15.7*x+19.4*x**2
}
function reverse_dcconvert(x){
		return (7760*x-579855)**0.5/388+157/388;
}
var drag = d3.behavior.drag()
		.origin(Object)
		.on("drag", dragmove);
var dragrect = svg.append("rect")
	.data([{x: width / 2, y: 330}])
	.attr("id", "active")
	.attr("x", function(d) { return d.x; })
	.attr("y", function(d) { return d.y; })
	.attr("height", 20)
	.attr("width", 20)
	.attr("fill-opacity", .5)
	.attr("cursor", "move")
	.attr("id", "dragRect")
	.call(drag);
function dragmove(d) {
		dragrect.attr("x", d.x = Math.max(272, Math.min(800 , d3.event.x)));}
function sortFunction(a, b) {
		if (a[0] === b[0]) {
				return 0;
		}
		else {
				return (a[0] < b[0]) ? -1 : 1;
		}
}
function KNN(categories, distance,x,k){
	dist = [];
	for (var i = 0;i<distance.length;i++ ){
		dist.push([Math.abs(distance[i] - x),categories[i]]);
		dist.sort(sortFunction);
	}

		var sum = 0;
		for(var i = 0;i<3;i++){

				sum = sum+ dist[i][1] ;
		}
		return(reverse_dcconvert(dist[0][1]));
}
function datareturn(xpos){
	h = 9*2.54/100;
	g = 9.81;
	theta = 47.5;
	if (document.getElementById("cars")[0].selected == true){
		d = (xpos/1000) +1.74*2.54/100 ;
		v0 = Math.pow(((g*d*d)/(2*d*dsin(theta)*dcos(theta)+2*h*dcos(theta)*dcos(theta))),0.5);
		xv0 = v0*dcos(theta);
		yv0 = v0*dsin(theta);
		time = d/xv0;
		timestep = time/100;
		var data = [];

		for(var i=0; i <100;i++){
			if (v0>1.53){
				xv0 =1.53*dcos(theta);
			}

			x = 1.8*xv0*timestep*i;
			y = yv0*timestep*i + 0.5*-1*g*(timestep*i)**2;
			data.push([200+x*600 ,200-y*600]);
		}

		distance = 270*d/(0.601696-0.073696);
		console.log(dcconvert(v0), distance);
		var removetext = svg.select("#speedval").remove();
		var removetext = svg.select("#distval").remove();
		var text = svg.append("text")
			.attr("dy","0em")
			.attr("x", 40)
			.attr("y",40)
			.attr("id","speedval")
			.text('Velocity:  '+String(dcconvert(v0)).slice(0,5)+'%')
			.style("font-size","16px")
			.style("background-color", "white")
			.style("fill","black")
			.style("stroke","none");
		svg.append("text")
			.attr("x",40)
			.attr("y",60)
			.attr("id","distval")
			.text('Distance:  '+String(distance).slice(0,4)+' cm')
			.style("font-size","16px")
			.style("background-color", "white")
			.style("fill","black")
			.style("stroke","none");
		return data;
	}
	else {
		categories = [75,75,75,80,80,80,85,85,85,90,90,90,95,95,95];
		distance = [32,49,68,139,157,145,199,209,197,243,259,250,298,290,302];
		timearray = [.25,.27,0.28,0.29,0.3]
		v0 = KNN(categories,distance,(xpos) +1.74*2.54/100 ,3);
		xv0 = v0*dcos(theta);
		yv0 = v0*dsin(theta);
		d = (xpos/1000) +1.74*2.54/100 ;

		var time_i = (Math.round(dcconvert(v0))-75)/5;
		time = timearray[time_i];
		timestep = time/100;
		var data = [];
		for(var i=0; i <100;i++){
			if (v0>1.53){
				xv0 =1.53*dcos(theta);
			}
			x = 1.6*xv0*timestep*i;
			y = yv0*timestep*i + 0.5*-1*g*(timestep*i)**2;
			data.push([200+x*600 ,200-y*600]);
		}
		distance = 270*d/(0.601696-0.073696);
		console.log(dcconvert(v0), distance);

		return data;
	}
}

data = datareturn(170);

//pathData = [{"x":data[0][0], "y":data[0][1]}, {"x":100, "y":100},{"x":120, "y":200},{"x":200, "y":70}];

//Creation of Line
var path = svg.append("path")
		.data([data])
		.attr("d", d3.svg.line()
		.interpolate("basis"));
var reset = d3.select("#reset")
	.on("click",function(){
		var obj =document.getElementById("dragRect").getClientRects();
		xpos = obj[0].x-8;
		data = datareturn(xpos-242);
		svg.select("path").remove();
		path = svg.append("path")
				.data([data])
				.attr("d", d3.svg.line()
				.interpolate("basis"));
	});
var start = d3.select("#start")
	.on("click",function(){
	transitionA();});
var circle = svg.append("circle")
		.attr("cx", 0)
		.attr("cy", 0)
		.attr("r",8)
		.style("fill","white")
		.style("z-index",30);

function transitionA() {
	circle.transition()
			.duration(5000)
			.attrTween("transform", translateAlong(path.node()));
}
function translateAlong(path) {
	var l = path.getTotalLength();
	return function(d, i, a) {
		return function(t) {
			var p = path.getPointAtLength(t *4* l);
			return "translate(" + p.x + "," + p.y + ")";
		};
	};
}




		</code></pre>
	</body>
